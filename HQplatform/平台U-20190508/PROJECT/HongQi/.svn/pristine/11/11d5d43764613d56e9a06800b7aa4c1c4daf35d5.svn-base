<?xml version="1.0" encoding="utf-8" ?>
<Function id="VW2000_DTC_Filter_Match" description="VW2000_DTC_Get_Match_Filter">
<Inputs>
<Variable id="DTC_String" type="8" data="&quot;&quot;" description="Source string"/>
<Variable id="DTC_String_Filter" type="8" data="&quot;&quot;"/>
</Inputs>
<Script>--[[*****************************************************************************
this is used to   DTC Filter Match
intput parameter:DTC_String;DTC_String_Filter;

02/26/2016     created by viforce
******************************************************************************--]]

if (DTC_String == "") then
engine.StatValue = "DTC_String : get no value";
engine.println("#INFO# DTC_String : Get no value ".."\n") ;engine.LastError = 0 ;return;
end;

if (DTC_String == "NG") then
engine.StatValue = "DTC_String : Negative Response";
engine.println("#INFO# DTC_String : Service Err NG ".."\n") ;engine.LastError = 1 ;return;
end;

if(DTC_String_Filter == "") then
engine.StatValue = "DTC_String_Filter : get no value";
engine.println("#ERROR# DTC_String_Filter :set no value".."\n");engine.LastError = 1 ;return;
end;


local iFSP_Filter = DTC_String_Filter..";";
--local Tmp_DTC_String = string.sub(DTC_String, 2, -1);
local Tmp_DTC_String = LibGeneral.hex2str(DTC_String);
local pos_0,pos_1,pos_2,pos_3;
local errStr;
local errText;

engine.println("iFSP_Filter : "..iFSP_Filter.."DTC_String : "..LibGeneral.hex2str(DTC_String).."\n");
while true do

	pos_0,pos_1 = string.find(iFSP_Filter,";;");
	if (pos_0 == nil) then
		break;
	end
	if (pos_1 == string.len(iFSP_Filter)) then
	iFSP_Filter = string.sub(iFSP_Filter,1,pos_0);
	break;
	end
	iFSP_Filter = string.sub(iFSP_Filter,1,pos_0)..string.sub(iFSP_Filter,pos_1+1,-1);

end


if (string.sub(iFSP_Filter,1,1) == ";") then
	iFSP_Filter = string.sub(iFSP_Filter,2,-1);
	end

while (string.len(iFSP_Filter) &gt; 0) do

	pos_0,pos_1 = string.find(iFSP_Filter,";");
if(pos_0 == nil) then engine.StatValue = "GET NO MATCH CODE";engine.LastError = 0;break;end;
	errText = string.sub(iFSP_Filter,1,pos_0 - 1);
	engine.println("errtext :  "..errText.."  ".."pos_0 ::: "..string.format("%d",pos_0).."\n");
	iFSP_Filter = string.sub(iFSP_Filter,pos_1+1,-1);
        errStr = string.upper(errText);
	
	   pos_2,pos_3 = string.find(Tmp_DTC_String,errStr);
           engine.println("pos_2 : "..string.format("%d",pos_2).."pos_3: "..string.format("%d",pos_3).."\n");
           if(pos_2 ~= nil) then engine.StatValue = "GET MATCH CODE";engine.LastError = 1;break; end;
end;
</Script></Function>

